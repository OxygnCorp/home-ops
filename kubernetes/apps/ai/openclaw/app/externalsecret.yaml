---
# yaml-language-server: $schema=https://k8s-schemas.oxygn.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: openclaw
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: openclaw-secret
    template:
      engineVersion: v2
      data:
        ## Gateway token for authentication
        OPENCLAW_GATEWAY_TOKEN: "{{ .OPENCLAW_GATEWAY_TOKEN }}"
        ##Discord
        DISCORD_BOT_TOKEN: "{{ .DISCORD_BOT_TOKEN }}"
        ## Github Access
        GITHUB_APP_ID: "{{ .GITHUB_APP_ID }}"
        GITHUB_APP_INSTALLATION_ID: "{{ .GITHUB_APP_INSTALLATION_ID }}"
        GITHUB_APP_PRIVATE_KEY: "{{ .GITHUB_APP_PRIVATE_KEY }}"
        ## Google Access
        GOG_CLIENT_ID: "{{ .GOG_CLIENT_ID }}"
        GOG_CLIENT_SECRET: "{{ .GOG_CLIENT_SECRET }}"
        GOG_KEYRING_PASSWORD: "{{ .GOG_KEYRING_PASSWORD }}"
        GOG_ACCOUNT: "{{ .GOG_ACCOUNT }}"
        GOG_REFRESH_TOKEN: "{{ .GOG_REFRESH_TOKEN }}"
        GOOGLE_PLACES_API_KEY: "{{ .GOOGLE_PLACES_API_KEY }}"
        ## Todoist
        TODOIST_API_TOKEN: "{{ .TODOIST_API_TOKEN }}"
        ## 1password
        OP_SERVICE_ACCOUNT_TOKEN: "{{ .OP_SERVICE_ACCOUNT_TOKEN }}"
        ## Anthropic
        ANTHROPIC_API_KEY: "{{ .ANTHROPIC_API_KEY }}"
  dataFrom:
    - extract:
        key: openclaw
---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw-config
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: *name
    template:
      data:
        ## OpenClaw configuration file
        openclaw.json: |
          {
            "gateway": {
              "mode": "local",
              "auth": {
                "mode": "token",
                "token": "{{ .OPENCLAW_GATEWAY_TOKEN }}"
              },
              "port": 18789,
              "bind": "loopback",
              "tailscale": {
                "mode": "off",
                "resetOnExit": false
              },
              "trustedProxies": ["10.42.0.0/16", "10.10.0.0/16"]
            },
            "browser": {
              "enabled": true,
              "defaultProfile": "default",
              "profiles": {
                "default": {
                  "cdpUrl": "http://localhost:9222",
                  "color": "#4285F4"
                }
              }
            },
            "agents": {
              "defaults": {
                "workspace": "/home/node/.openclaw/workspace",
                "model": {
                  "primary": "anthropic/claude-opus-4-6",
                  "fallbacks": [
                    "anthropic/claude-opus-4-5",
                    "anthropic/claude-sonnet-4-5"
                  ]
                },
                "models": {
                  "anthropic/claude-opus-4-5": {},
                  "anthropic/claude-opus-4-6": {
                    "alias": "opus"
                  },
                  "anthropic/claude-sonnet-4-5": {
                    "alias": "sonnet"
                  }
                },
                "userTimezone": "UTC+2",
                "timeoutSeconds": 600,
                "maxConcurrent": 1,
                "memorySearch": {
                  "provider": "gemini",
                  "model": "gemini-embedding-001",
                  "fallback": "local",
                  "local": {
                    "modelPath": "hf:ggml-org/embeddinggemma-300M-GGUF/embeddinggemma-300M-Q8_0.gguf"
                  },
                  "sync": {
                    "watch": true
                  },
                  "query": {
                    "hybrid": {
                      "enabled": true,
                      "vectorWeight": 0.7,
                      "textWeight": 0.3
                    }
                  }
                }
              },
              "list": [
                {
                  "id": "main",
                  "default": true,
                  "identity": {
                    "name": "OpenClaw",
                    "emoji": "ðŸ¦ž"
                  }
                }
              ]
            },
            "session": {
              "scope": "per-sender",
              "store": "/home/node/.openclaw/sessions",
              "reset": {
                "mode": "idle",
                "idleMinutes": 60
              }
            },
            "logging": {
              "level": "info",
              "consoleLevel": "info",
              "consoleStyle": "compact",
              "redactSensitive": "tools"
            },
            "tools": {
              "profile": "full",
              "web": {
                "search": {
                  "enabled": false
                },
                "fetch": {
                  "enabled": true
                }
              }
            },
            "hooks": {
              "enabled": true,
              "path": "/webhooks",
              "token": "{{ .GITHUB_WEBHOOK_SECRET }}",
              "maxBodyBytes": 262144,
              "transformsDir": "/home/node/.openclaw/workspace",
              "mappings": [
                {
                  "id": "github-pr-notifications",
                  "match": {
                    "path": "github"
                  },
                  "action": "agent",
                  "wakeMode": "now",
                  "name": "GitHub PR Handler",
                  "transform": {
                    "module": "./github-webhook-transform.js"
                  }
                }
              ]
            },
            "plugins": {
              "entries": {
                "discord": {
                  "enabled": true
                }
              }
            },
            "channels": {
              "discord": {
                "enabled": true,
                "token": "{{ .DISCORD_BOT_TOKEN }}",
                "groupPolicy": "allowlist",
                "guilds": {
                  "{{ .DISCORD_GUILD_ID }}": {
                    "channels": {
                      "{{ .DISCORD_CHANNEL_ID }}": {
                        "allow": true,
                        "requireMention": false,
                        "skills": ["search", "docs"],
                        "systemPrompt": "Keep answers short."
                      }
                    }
                  }
                },
                "dm": {
                  "enabled": true,
                  "policy": "allowlist",
                  "allowFrom": ["{{ .DISCORD_USER_ID }}"],
                  "groupEnabled": false
                }
              }
            }
          }
  dataFrom:
    - extract:
        key: openclaw

machine:
  type: controlplane
  network:
    hostname: k8s-2
  install:
    # extensions :
    # - siderolabs/i915
    # - siderolabs/intel-ucode
    # - siderolabs/mei
    # - siderolabs/nvidia-container-toolkit-lts
    # - siderolabs/nonfree-kmod-nvidia-lts
    # - siderolabs/qemu-guest-agent
    # - siderolabs/util-linux-tools
    image: factory.talos.dev/installer/e5fd836e1ef7383e984337c99b174299d47651325e4bdbdb23ed63b448765132:{{ ENV.TALOS_VERSION }}
    extraKernelArgs:
      - i915.enable_guc=3                   # Meteor Lake CPU / iGPU
      - sysctl.kernel.kexec_load_disabled=1 # Meteor Lake CPU / iGPU
  sysctls:
    net.core.bpf_jit_harden: "1"
  udev:
    rules:
      - # Intel GPU
        SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
  kernel:
    modules:
      - name: nbd
      - name: nvidia
      - name: nvidia_uvm
      - name: nvidia_drm
      - name: nvidia_modeset
  nodeLabels:
    intel.feature.node.kubernetes.io/gpu: "true"


